<html>

<head>
    <link rel="manifest" href="manifest.json">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Clave Pokemon ORO y PLATA">
    <meta name="apple-mobile-web-app-title" content="Clave Pokemon ORO y PLATA">
    <meta name="msapplication-starturl" content="/index.html">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" type="image/png" sizes="512x512" href="icon.png">
    <link rel="apple-touch-icon" type="image/png" sizes="512x512" href="icon.png">
</head>

<body>
    <script language="javascript">
        window.addEventListener("onload", inicializar);

        function inicializar() {

            if (navigator.serviceworker) {
                navigator.serviceworker.register('https://tetradogpaw.github.io/PokemonOroYPlataClave/sw.js')
                    .then(() => console.log("registrado :)"))
                    .catch(console.error);
            }
            CargarCampos();
        }

        function CalculaClave() {
            const DIVISORBYTE = 256;
            const USHORTMAX = 65535;
            const A = 65;
            const a = 97;
            const ANintendo = 128;
            const aNintendo = 160;
            const CAMPOSNOMBREMAX = 5;

            var nombre = document.getElementById("inpNombre").value;
            var idTxt = document.getElementById("inpID").value;
            var dineroTxt = document.getElementById("inpDinero").value;
            var id;
            var dinero;
            var clave = 0;
            var i;
            var c;

            if (nombre != "" && idTxt != "" && dineroTxt != "") {
                id = parseInt(idTxt);
                dinero = parseInt(dineroTxt);

                for (i = 0; i < nombre.length && i < CAMPOSNOMBREMAX; i++) {
                    c = nombre.charCodeAt(i);
                    if (c >= a)
                        clave += c - a + aNintendo;
                    else
                        clave += c - A + ANintendo;
                }


                id %= USHORTMAX;

                clave += Math.floor(id / DIVISORBYTE) + (id % DIVISORBYTE);


                dinero %= USHORTMAX;

                clave += Math.floor(dinero / DIVISORBYTE) + (dinero % DIVISORBYTE);

                document.getElementById("lblClave").innerHTML = clave;
                GuardaCampos();
            } else console.error("parametros vacios, imposible calcular clave!");

        }

        function CargarCampos() {
            document.getElementById("inpNombre").value = localStorage.getItem("nombre");
            document.getElementById("inpID").value = localStorage.getItem("ID");
            document.getElementById("inpDinero").value = localStorage.getItem("dinero");
        }

        function GuardaCampos() {
            localStorage.setItem("nombre", document.getElementById("inpNombre").value);
            localStorage.setItem("ID", document.getElementById("inpID").value);
            localStorage.setItem("dinero", document.getElementById("inpDinero").value);
        }
    </script>
    <table>
        <tbody>
            <tr>
                <td>Nombre</td>
                <td><input id="inpNombre" placeholder="Nombre"></td>
            </tr>
            <tr>
                <td>ID</td>
                <td><input id="inpID" placeholder="ID"></td>
            </tr>
            <tr>
                <td>DINERO</td>
                <td><input id="inpDinero" placeholder="Dinero"></td>
            </tr>
            <tr>
                <td><label>Clave</label></td>
                <td><label id="lblClave" stle="min-height:25px"></label></td>

            </tr>
            <tr>
                <td><button onclick="CalculaClave()">Calcula</button></td>
            </tr>
        </tbody>
    </table>

</body>

</html>